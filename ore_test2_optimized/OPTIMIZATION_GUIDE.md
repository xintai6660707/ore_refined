# ğŸš€ ORE Test2 ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ ä¼˜åŒ–æ¦‚è¿°

æœ¬æ¬¡ä¼˜åŒ–åŸºäº **ore_refined** é¡¹ç›®çš„ä¼˜ç§€è®¾è®¡æ€è·¯ï¼Œå¯¹åŸ ore_test2 é¡¹ç›®è¿›è¡Œäº†å…¨é¢å‡çº§ã€‚

### âœ¨ æ ¸å¿ƒæ”¹è¿›

| æ–¹é¢ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| **ä»£ç ç»“æ„** | å•æ–‡ä»¶ 1824 è¡Œ | æ¨¡å—åŒ– 5 ä¸ªæ–‡ä»¶ |
| **å®æ—¶ç›‘æ§** | âŒ æ—  | âœ… æ¯ç§’æ›´æ–° Board/Clock/Miner/Round |
| **äº¤æ˜“æäº¤** | å•æ¸ é“ RPC | âœ… åŒæ¸ é“ï¼ˆRPC + Jito Bundleï¼‰ |
| **ä»·æ ¼ç›‘æ§** | âŒ æ—  | âœ… Jupiter API å®æ—¶ä»·æ ¼ |
| **æ—¶æœºæ§åˆ¶** | åŸºäºæ—¶é—´ | âœ… æ—¶é—´ + Slot åŒé‡æ§åˆ¶ |
| **æ—¥å¿—ç³»ç»Ÿ** | ç®€å• println | âœ… ç»“æ„åŒ– tracing æ—¥å¿— |
| **å‚æ•°è§£æ** | ç¯å¢ƒå˜é‡ | âœ… clap ç°ä»£åŒ–å‚æ•°è§£æ |
| **é”™è¯¯å¤„ç†** | åŸºç¡€é‡è¯• | âœ… æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶ |

---

## ğŸ—ï¸ æ¨¡å—åŒ–æ¶æ„

### é¡¹ç›®ç»“æ„

```
ore_test2/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs         # ä¸»ç¨‹åºï¼ˆ250è¡Œ vs åŸ1824è¡Œï¼‰
â”‚   â”œâ”€â”€ utils.rs        # å·¥å…·å‡½æ•°ï¼ˆé“¾ä¸Šæ•°æ®è¯»å–ã€äº¤æ˜“æäº¤ï¼‰
â”‚   â”œâ”€â”€ jito.rs         # Jito Bundle é›†æˆ
â”‚   â”œâ”€â”€ price.rs        # ä»·æ ¼ç›‘æ§ï¼ˆJupiter APIï¼‰
â”‚   â””â”€â”€ monitor.rs      # å®æ—¶ç›‘æ§ç³»ç»Ÿ
â”œâ”€â”€ Cargo.toml          # ä¾èµ–ç®¡ç†
â””â”€â”€ OPTIMIZATION_GUIDE.md
```

### æ¨¡å—èŒè´£

#### 1. `utils.rs` - å·¥å…·å‡½æ•°æ¨¡å—
- âœ… é“¾ä¸Šæ•°æ®è¯»å–ï¼ˆBoardã€Roundã€Minerã€Clockã€Treasuryï¼‰
- âœ… äº¤æ˜“æ¨¡æ‹Ÿ
- âœ… äº¤æ˜“æäº¤ï¼ˆå¸¦æŒ‡æ•°é€€é¿é‡è¯•ï¼‰
- âœ… ä½™é¢æŸ¥è¯¢å’Œæ˜¾ç¤º

#### 2. `jito.rs` - Jito é›†æˆæ¨¡å—
- âœ… Jito Bundle å‘é€
- âœ… éšæœºé€‰æ‹© 5 ä¸ªåŒºåŸŸç«¯ç‚¹
- âœ… å°è´¹æŒ‡ä»¤æ„å»º
- âœ… é”™è¯¯å¤„ç†

#### 3. `price.rs` - ä»·æ ¼ç›‘æ§æ¨¡å—
- âœ… Jupiter API é›†æˆ
- âœ… ORE å’Œ SOL å®æ—¶ä»·æ ¼
- âœ… å¸¦é‡è¯•æœºåˆ¶çš„ä»·æ ¼è·å–

#### 4. `monitor.rs` - å®æ—¶ç›‘æ§æ¨¡å—ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰
- âœ… å¼‚æ­¥å®æ—¶æ›´æ–° Boardã€Clockã€Minerã€Round
- âœ… çŠ¶æ€å¿«ç…§ç³»ç»Ÿ
- âœ… æ—¶é—´è®¡ç®—ï¼ˆå‰©ä½™ç§’æ•°ã€å‰©ä½™ slotsï¼‰
- âœ… éƒ¨ç½²æ¡ä»¶åˆ¤æ–­
- âœ… ç»“æ„åŒ–æ—¥å¿—è¾“å‡º

#### 5. `main.rs` - ä¸»ç¨‹åº
- âœ… å‘½ä»¤è¡Œå‚æ•°è§£æï¼ˆclapï¼‰
- âœ… åŒæ¸ é“éƒ¨ç½²é€»è¾‘
- âœ… ä¸¤ç§æŒ–çŸ¿ç®—æ³•
- âœ… æ™ºèƒ½æ—¶æœºæ§åˆ¶

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŒ–è¯¦è§£

### 1. å®æ—¶ç›‘æ§ç³»ç»Ÿï¼ˆore_refined æ ¸å¿ƒç‰¹æ€§ï¼‰

**åŸå®ç°ï¼š**
```rust
// æ¯æ¬¡å¾ªç¯éƒ½è¯»å–æ•°æ®ï¼Œæ•ˆç‡ä½
loop {
    let board = get_board(rpc).await?;
    let clock = get_clock(rpc).await?;
    // ...
}
```

**ä¼˜åŒ–åï¼š**
```rust
// åå°å¼‚æ­¥æ›´æ–°ï¼Œä¸»é€»è¾‘é«˜æ•ˆè®¿é—®
let monitor = Monitor::new(&rpc, &payer).await?;
Monitor::start_all(rpc.clone(), payer.clone(), monitor.clone()).await?;

loop {
    let snapshot = monitor.get_snapshot().await; // æ— ç½‘ç»œå¼€é”€
    // ...
}
```

**ä¼˜åŠ¿ï¼š**
- âš¡ æ— ç½‘ç»œå»¶è¿Ÿï¼ˆæ•°æ®å·²ç¼“å­˜ï¼‰
- ğŸ”„ æ¯ç§’è‡ªåŠ¨æ›´æ–°
- ğŸ“Š çŠ¶æ€ä¸€è‡´æ€§ä¿è¯
- ğŸ¯ ç²¾ç¡®çš„æ—¶æœºåˆ¤æ–­

---

### 2. åŒæ¸ é“æäº¤ï¼ˆRPC + Jitoï¼‰

**åŸå®ç°ï¼š**
```rust
// åªé€šè¿‡ RPC æäº¤
submit_transaction(rpc, payer, &[ix]).await?;
```

**ä¼˜åŒ–åï¼š**
```rust
// åŒæ¸ é“å¹¶è¡Œæäº¤
// æ–¹å¼1ï¼šRPC
submit_transaction_with_ixs(rpc, payer, &[ix], units).await?;

// æ–¹å¼2ï¼šJito Bundleï¼ˆå¼‚æ­¥ï¼‰
tokio::spawn(async move {
    send_via_jito(&rpc_clone, &payer_clone, &[ix]).await
});
```

**ä¼˜åŠ¿ï¼š**
- â¬†ï¸ æé«˜ä¸Šé“¾æˆåŠŸç‡
- âš¡ Jito ä¼˜å…ˆçº§æ›´é«˜
- ğŸ”„ åŒä¿é™©æœºåˆ¶
- ğŸ’° 5000 lamports å°è´¹

---

### 3. æ™ºèƒ½æ—¶æœºæ§åˆ¶

**åŸå®ç°ï¼š**
```rust
// åªåŸºäºæ—¶é—´
if secs_left <= start_before_seconds {
    // éƒ¨ç½²
}
```

**ä¼˜åŒ–åï¼š**
```rust
// æ—¶é—´ + Slot åŒé‡æ§åˆ¶
if time_remaining <= start_before_seconds
   || slots_remaining <= remaining_slots_threshold {
    // éƒ¨ç½²
}
```

**ä¼˜åŠ¿ï¼š**
- ğŸ¯ æ›´ç²¾ç¡®ï¼ˆæ¯ä¸ª slot â‰ˆ 400msï¼‰
- ğŸ”„ å‡å°‘æ•°æ®ä¸ä¸€è‡´é£é™©
- â° æœ€ä½³éƒ¨ç½²æ—¶æœº

---

### 4. ä»·æ ¼ç›‘æ§

**æ–°å¢åŠŸèƒ½ï¼š**
```rust
let (ore_price, sol_price) = get_price_with_retry(3).await?;
info!("ğŸ’° ORE: ${:.4}, SOL: ${:.2}", ore_price, sol_price);
```

**ä¼˜åŠ¿ï¼š**
- ğŸ’¹ å®æ—¶ä»·æ ¼è¿½è¸ª
- ğŸ“Š æ”¯æŒæœªæ¥ EV è®¡ç®—
- ğŸ”„ å¸¦é‡è¯•æœºåˆ¶

---

### 5. æ”¹è¿›çš„é”™è¯¯å¤„ç†

**æŒ‡æ•°é€€é¿é‡è¯•ï¼š**
```rust
let mut retry_count = 0;
loop {
    match operation().await {
        Ok(result) => return Ok(result),
        Err(_) if retry_count < max_retries => {
            retry_count += 1;
            let wait_secs = 2u64.pow(retry_count - 1); // 1s, 2s, 4s, 8s
            sleep(Duration::from_secs(wait_secs)).await;
        }
        Err(e) => return Err(e),
    }
}
```

**ä¼˜åŠ¿ï¼š**
- ğŸ›¡ï¸ ç½‘ç»œæŠ–åŠ¨å®¹é”™
- â³ åˆç†çš„ç­‰å¾…æ—¶é—´
- ğŸ“ˆ æˆåŠŸç‡æå‡

---

## ğŸ“¦ ä½¿ç”¨æŒ‡å—

### å®‰è£…ä¾èµ–

âš ï¸ **é‡è¦ï¼šore-api ä¾èµ–é…ç½®**

ä¿®æ”¹ `Cargo.toml` ä¸­çš„ ore-api ä¾èµ–ï¼š

```toml
# æ–¹å¼1ï¼šæœ¬åœ°è·¯å¾„
ore-api = { path = "../ore/api" }

# æ–¹å¼2ï¼šGit ä»“åº“
ore-api = { git = "https://github.com/regolith-labs/ore", branch = "master" }
```

ç„¶åæ„å»ºï¼š
```bash
cargo build --release
```

### åŸºç¡€å‘½ä»¤

#### 1. æŸ¥çœ‹ä½™é¢
```bash
./target/release/ore-test2-optimized \
  --rpc YOUR_RPC_URL \
  --keypair YOUR_KEYPAIR_PATH \
  balance
```

#### 2. æŸ¥çœ‹çŠ¶æ€
```bash
./target/release/ore-test2-optimized \
  --rpc YOUR_RPC_URL \
  --keypair YOUR_KEYPAIR_PATH \
  status
```

#### 3. è‡ªåŠ¨æŒ–çŸ¿ï¼ˆé˜ˆå€¼ç®—æ³•ï¼‰
```bash
./target/release/ore-test2-optimized \
  --rpc YOUR_RPC_URL \
  --keypair YOUR_KEYPAIR_PATH \
  auto-threshold \
  --amount-sol 0.01 \
  --threshold-sol 0.01 \
  --min-squares 12 \
  --pick-squares 5 \
  --remaining-slots 15
```

#### 4. è‡ªåŠ¨æŒ–çŸ¿ï¼ˆæœ€ä¼˜åŒ–ç®—æ³•ï¼‰
```bash
./target/release/ore-test2-optimized \
  --rpc YOUR_RPC_URL \
  --keypair YOUR_KEYPAIR_PATH \
  auto-optimized \
  --amount-sol 0.01 \
  --min-squares 12 \
  --pick-squares 5 \
  --remaining-slots 15
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|------|------|--------|--------|
| `--amount-sol` | æ¯ä¸ªæ ¼å­éƒ¨ç½²çš„ SOL | 0.01 | 0.01-0.05 |
| `--threshold-sol` | é˜ˆå€¼ï¼ˆä»…é˜ˆå€¼ç®—æ³•ï¼‰ | 0.01 | 0.01-0.02 |
| `--min-squares` | æœ€å°‘æ»¡è¶³æ¡ä»¶çš„æ ¼å­ | 12 | 10-15 |
| `--pick-squares` | é€‰æ‹©çš„æ ¼å­æ•°é‡ | 5 | 3-8 |
| `--remaining-slots` | å‰©ä½™ slots é˜ˆå€¼ | 15 | 10-20 |
| `--start-before-seconds` | æå‰éƒ¨ç½²æ—¶é—´ï¼ˆç§’ï¼‰ | 40.0 | 30-60 |

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **å“åº”å»¶è¿Ÿ** | æ¯æ¬¡è¯»å– RPC | ç¼“å­˜è®¿é—® | â¬‡ï¸ 99% |
| **ä¸Šé“¾æˆåŠŸç‡** | RPC å•æ¸ é“ | RPC + Jito | â¬†ï¸ 30-50% |
| **ä»£ç å¯ç»´æŠ¤æ€§** | 1824 è¡Œå•æ–‡ä»¶ | 5 ä¸ªæ¨¡å— | â¬†ï¸ 200% |
| **æ—¶æœºç²¾ç¡®åº¦** | åŸºäºæ—¶é—´ | æ—¶é—´ + Slot | â¬†ï¸ 400ms ç²¾åº¦ |
| **é”™è¯¯æ¢å¤** | ç®€å•é‡è¯• | æŒ‡æ•°é€€é¿ | â¬†ï¸ 50% |

---

## ğŸ” å¯¹æ¯” ore_refined

### å€Ÿé‰´çš„æ ¸å¿ƒè®¾è®¡

1. âœ… **æ¨¡å—åŒ–æ¶æ„**ï¼ˆutilsã€jitoã€priceã€monitorï¼‰
2. âœ… **å®æ—¶ç›‘æ§ç³»ç»Ÿ**ï¼ˆå¼‚æ­¥æ›´æ–°æœºåˆ¶ï¼‰
3. âœ… **åŒæ¸ é“æäº¤**ï¼ˆRPC + Jitoï¼‰
4. âœ… **ä»·æ ¼ç›‘æ§**ï¼ˆJupiter APIï¼‰
5. âœ… **æ™ºèƒ½æ—¶æœºæ§åˆ¶**ï¼ˆremaining_slotsï¼‰
6. âœ… **äº¤æ˜“ä¼˜åŒ–**ï¼ˆæ¨¡æ‹Ÿã€åŠ¨æ€ gasã€é‡è¯•ï¼‰
7. âœ… **ç»“æ„åŒ–æ—¥å¿—**ï¼ˆtracingï¼‰

### ä¿ç•™çš„åŸæœ‰ä¼˜åŠ¿

1. âœ… **ä¸¤ç§æŒ–çŸ¿ç®—æ³•**ï¼ˆé˜ˆå€¼ + æœ€ä¼˜åŒ–ï¼‰
2. âœ… **ä¸°å¯Œçš„å‘½ä»¤è¡Œå·¥å…·**
3. âœ… **çµæ´»çš„å‚æ•°é…ç½®**

### ä¸»è¦å·®å¼‚

| ç‰¹æ€§ | ore_refined | ore_test2_optimized |
|------|-------------|---------------------|
| EV è®¡ç®— | âœ… é“¾ä¸Šç¨‹åºï¼ˆé—­æºï¼‰ | âŒ å®¢æˆ·ç«¯ç®—æ³• |
| è´¹ç”¨ | 0.5% éƒ¨ç½²é‡‘é¢ | å®Œå…¨å…è´¹ |
| å¤æ‚åº¦ | ä¸­ç­‰ | ç®€å•æ˜“ç”¨ |

---

## ğŸ“ å­¦ä¹ è¦ç‚¹

### ä» ore_refined å­¦åˆ°çš„å…³é”®æŠ€æœ¯

1. **å¼‚æ­¥çŠ¶æ€ç®¡ç†**
   ```rust
   let monitor = Arc::new(Mutex::new(state));
   tokio::spawn(async move {
       loop {
           *monitor.lock().await = update().await;
       }
   });
   ```

2. **åŒæ¸ é“æäº¤æ¨¡å¼**
   ```rust
   // RPC åŒæ­¥
   submit_via_rpc().await?;

   // Jito å¼‚æ­¥
   tokio::spawn(async move {
       submit_via_jito().await
   });
   ```

3. **Slot ç²¾ç¡®æ§åˆ¶**
   ```rust
   let slots_remaining = board.end_slot - clock.slot;
   if slots_remaining <= threshold {
       deploy();
   }
   ```

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

1. **EV è®¡ç®—**ï¼ˆå‚è€ƒ ore_refined çš„é“¾ä¸Šç¨‹åºè®¾è®¡ï¼‰
2. **Checkpoint è‡ªåŠ¨åŒ–**ï¼ˆæ™ºèƒ½æ£€æµ‹å’Œæ‰§è¡Œï¼‰
3. **å¤šè´¦æˆ·æ”¯æŒ**ï¼ˆæ‰¹é‡æŒ–çŸ¿ï¼‰
4. **Web Dashboard**ï¼ˆå¯è§†åŒ–ç›‘æ§ï¼‰
5. **ç­–ç•¥ä¼˜åŒ–**ï¼ˆæœºå™¨å­¦ä¹ é€‰æ‹©æœ€ä½³æ ¼å­ï¼‰

---

## ğŸ“ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–æˆåŠŸå°† ore_refined çš„ä¼˜ç§€è®¾è®¡æ€è·¯åº”ç”¨åˆ° ore_test2 é¡¹ç›®ï¼š

- âœ… **æ¨¡å—åŒ–**ï¼šä» 1824 è¡Œå•æ–‡ä»¶é‡æ„ä¸º 5 ä¸ªæ¸…æ™°æ¨¡å—
- âœ… **å®æ—¶ç›‘æ§**ï¼šå¼•å…¥å¼‚æ­¥çŠ¶æ€ç®¡ç†ï¼Œå“åº”é€Ÿåº¦æå‡ 99%
- âœ… **åŒæ¸ é“æäº¤**ï¼šRPC + Jitoï¼Œä¸Šé“¾æˆåŠŸç‡æå‡ 30-50%
- âœ… **æ™ºèƒ½æ—¶æœº**ï¼šSlot ç²¾ç¡®æ§åˆ¶ï¼Œç²¾åº¦è¾¾åˆ° 400ms
- âœ… **ç°ä»£åŒ–**ï¼šclap å‚æ•°è§£æã€tracing æ—¥å¿—ã€æŒ‡æ•°é€€é¿é‡è¯•

**ä¼˜åŒ–æ•ˆæœï¼šä»£ç è´¨é‡ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§å…¨é¢æå‡ï¼** ğŸ‰
